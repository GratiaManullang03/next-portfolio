<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Organic Living Grid</title>
        <style>
            body,
            html {
                margin: 0;
                padding: 0;
                width: 100%;
                height: 100%;
                overflow: hidden;
                background-color: #050505;
            }
            canvas {
                display: block;
            }
        </style>
    </head>
    <body>
        <canvas id="gridCanvas"></canvas>

        <script>
            const canvas = document.getElementById('gridCanvas');
            const ctx = canvas.getContext('2d');

            const config = {
                tileSize: 30,
                gap: 2,
                baseRadius: 150,
                maxRadius: 300,
                baseColor: '#080808', // Sangat gelap
                activeColor: '#5227FF',
                rippleColor: '#00f7ff',
                ambientColor: '#1a1a2e', // Warna napas (sedikit kebiruan gelap, bukan ungu terang)
                smoothness: 0.12,
            };

            let width, height, cols, rows;
            let mouse = {
                x: -1000,
                y: -1000,
                prevX: -1000,
                prevY: -1000,
                speed: 0,
            };
            let cursor = { x: -1000, y: -1000 };
            let ripples = [];
            let time = 0;

            function hexToRgb(hex) {
                const res = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(
                    hex
                );
                return res
                    ? {
                          r: parseInt(res[1], 16),
                          g: parseInt(res[2], 16),
                          b: parseInt(res[3], 16),
                      }
                    : { r: 0, g: 0, b: 0 };
            }

            const baseRgb = hexToRgb(config.baseColor);
            const activeRgb = hexToRgb(config.activeColor);
            const rippleRgb = hexToRgb(config.rippleColor);
            const ambientRgb = hexToRgb(config.ambientColor); // RGB khusus untuk napas

            function init() {
                width = canvas.width = window.innerWidth;
                height = canvas.height = window.innerHeight;
                cols = Math.ceil(width / (config.tileSize + config.gap));
                rows = Math.ceil(height / (config.tileSize + config.gap));
            }

            function lerp(start, end, amt) {
                return (1 - amt) * start + amt * end;
            }

            function animate() {
                time += 0.015; // Speed napas diperlambat agar rileks

                // Update Mouse Logic
                const distX = mouse.x - mouse.prevX;
                const distY = mouse.y - mouse.prevY;
                const currentSpeed = Math.hypot(distX, distY);
                mouse.speed = lerp(mouse.speed, currentSpeed, 0.05);
                mouse.prevX = mouse.x;
                mouse.prevY = mouse.y;
                const dynamicRadius = Math.min(
                    config.baseRadius + mouse.speed * 3,
                    config.maxRadius
                );

                cursor.x = lerp(cursor.x, mouse.x, config.smoothness);
                cursor.y = lerp(cursor.y, mouse.y, config.smoothness);

                // Clear Canvas
                ctx.fillStyle = '#050505';
                ctx.fillRect(0, 0, width, height);

                // Update Ripples
                ripples = ripples.filter((r) => {
                    r.age += 1;
                    r.radius += 5;
                    return r.age < r.lifespan;
                });

                // Loop Grid
                for (let i = 0; i < cols; i++) {
                    for (let j = 0; j < rows; j++) {
                        const x = i * (config.tileSize + config.gap);
                        const y = j * (config.tileSize + config.gap);
                        const centerX = x + config.tileSize / 2;
                        const centerY = y + config.tileSize / 2;

                        // --- 1. ORGANIC BREATHING (PERBAIKAN DISINI) ---
                        // Kita menggunakan koordinat i, j yang diskalakan
                        // Gelombang 1: Gerakan horizontal lambat
                        const wave1 = Math.sin(i * 0.05 + time);
                        // Gelombang 2: Gerakan vertikal dengan fase beda
                        const wave2 = Math.sin(j * 0.06 + time * 0.8);
                        // Gelombang 3: Gerakan diagonal untuk memecah pola kotak
                        const wave3 = Math.sin((i + j) * 0.03 + time * 0.5);

                        // Gabungkan ketiganya. Hasilnya berkisar -3 sampai 3.
                        // Kita normalkan agar nilainya positif dan subtle.
                        const noise = (wave1 + wave2 + wave3) / 3;

                        // Map noise (-1 s/d 1) menjadi intensitas cahaya (0.0 s/d 0.15)
                        // Math.max(0, ...) memastikan tidak ada nilai negatif (hitam pekat)
                        let ambientIntensity = Math.max(0, noise * 0.12);

                        // --- 2. MOUSE LIGHT ---
                        const dx = cursor.x - centerX;
                        const dy = cursor.y - centerY;
                        const dist = Math.hypot(dx, dy);
                        let mouseLight = 0;

                        if (dist < dynamicRadius) {
                            let mInt = 1 - dist / dynamicRadius;
                            mouseLight = mInt * mInt * mInt;
                        }

                        // --- 3. RIPPLE LIGHT ---
                        let rippleLight = 0;
                        ripples.forEach((r) => {
                            const dToRipple = Math.hypot(
                                centerX - r.x,
                                centerY - r.y
                            );
                            const ringWidth = 50;
                            if (Math.abs(dToRipple - r.radius) < ringWidth) {
                                let rInt =
                                    1 -
                                    Math.abs(dToRipple - r.radius) / ringWidth;
                                let fade = 1 - r.age / r.lifespan;
                                rippleLight += rInt * fade * 1.5;
                            }
                        });

                        // --- MIXING STRATEGY BARU ---

                        // Start dengan Base Color
                        let r = baseRgb.r;
                        let g = baseRgb.g;
                        let b = baseRgb.b;

                        // Tambahkan Ambient (Napas)
                        // Ambient punya warna sendiri (sedikit biru gelap) agar grid terasa "dingin"
                        if (ambientIntensity > 0) {
                            r += (ambientRgb.r - r) * ambientIntensity;
                            g += (ambientRgb.g - g) * ambientIntensity;
                            b += (ambientRgb.b - b) * ambientIntensity;
                        }

                        // Tambahkan Mouse (Active Color - Ungu)
                        if (mouseLight > 0) {
                            r += (activeRgb.r - r) * mouseLight;
                            g += (activeRgb.g - g) * mouseLight;
                            b += (activeRgb.b - b) * mouseLight;
                        }

                        // Tambahkan Ripple (Cyan - Paling Atas)
                        if (rippleLight > 0) {
                            r += (rippleRgb.r - r) * rippleLight;
                            g += (rippleRgb.g - g) * rippleLight;
                            b += (rippleRgb.b - b) * rippleLight;
                        }

                        // Clamp
                        r = Math.min(255, Math.max(0, r));
                        g = Math.min(255, Math.max(0, g));
                        b = Math.min(255, Math.max(0, b));

                        ctx.fillStyle = `rgb(${Math.round(r)},${Math.round(
                            g
                        )},${Math.round(b)})`;
                        ctx.fillRect(x, y, config.tileSize, config.tileSize);
                    }
                }

                requestAnimationFrame(animate);
            }

            // Listeners
            window.addEventListener('mousemove', (e) => {
                mouse.x = e.clientX;
                mouse.y = e.clientY;
            });

            window.addEventListener('click', (e) => {
                ripples.push({
                    x: e.clientX,
                    y: e.clientY,
                    radius: 0,
                    lifespan: 80, // Sedikit lebih lama umurnya
                    age: 0,
                });
            });

            window.addEventListener(
                'touchmove',
                (e) => {
                    mouse.x = e.touches[0].clientX;
                    mouse.y = e.touches[0].clientY;
                },
                { passive: true }
            );

            window.addEventListener('resize', init);

            init();
            animate();
        </script>
    </body>
</html>
